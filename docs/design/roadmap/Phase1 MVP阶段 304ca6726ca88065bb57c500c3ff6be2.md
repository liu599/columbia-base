# Phase1: MVP阶段

### Phase 1: 智能知识库与 Agent 多工具编排底座 (核心 MVP)

**阶段目标：** 抛弃传统的线性问答，首期直接跑通基于 LangGraph 或 Pydantic-AI 的 **Agentic Loop (智能体循环)**。实现文档解析入库的基础闭环，并赋予大模型动态路由调用多种工具（知识查库、写代码渲染 UI、管理日程、联网搜索）的能力，确立系统多模态交互的基础基座。

**各个语言/组件开发清单：**

- **前端层 (React 19 / Next.js)：**
    - **多模态流式对话引擎：** 封装基于 `@microsoft/fetch-event-source` 的 SSE 接收模块，支持标准的 Markdown 打字机渲染。
    - **UI Artifacts 渲染沙盒 (重点)：** 开发独立的动态组件渲染视窗。当识别到大模型调用了“代码 HTML 制作工具”生成 React 代码时，直接在界面右侧或对话流中实时编译并渲染出可交互的 UI。
    - **工具卡片库 (Tool Cards)：** 为 `Todo 工具`、`联网搜索工具` 等开发专属的展示卡片（例如：可直接勾选完成的 Todo Checkbox 列表 UI）。
- **业务服务层 (Java / Spring Boot)：**
    - **基础资产网关：** 提供文件元数据 (FileMetadata) 上传与管理的 REST API，打通 OSS 直传。
    - **SSE 实时流转基座：** 搭建基于 Redis Streams 的 `XREAD` 消费线程，实现 Python 到前端的 Token 流式安全透传。
    - **业务领域 API (赋能 AI)：** 开发 Todo 待办事项的增删改查 API（操作 MySQL）。*注意：这些 API 的主要消费者不是前端，而是后端的 Python Agent 工具。*
- **智能与基础服务层 (Python / FastAPI + LangGraph/pydantic-ai)：**
    - **混合检索流水线：** 接入大模型 API，实现文本的智能分块 (Chunking) 与向量化 (Embedding)，写入 ES Serverless。
    - **Agent 核心路由引擎 (重点)：** 构建基于 ReAct 逻辑的状态机循环。根据用户的 Prompt 意图，自动决策是否需要调用工具，以及调用哪些工具的组合。
    - **第一期系统工具集 (Skills Manifest) 落地：**
        - `search_personal_kb`: 核心知识工具。在 ES 中执行 TF-IDF (BM25) 与 Vector 的双路混合召回，并做 Rerank 重排。
        - `search_web`: 联网搜索工具。对接 DuckDuckGo 或 Bing Search API，打破大模型知识截止时间限制。
        - `manage_todos`: 日程工具。通过内部 gRPC 或 HTTP 调用 Java 的 Todo API，实现“用自然语言记事”。
        - `render_ui_component`: 代码与交互工具。约束大模型输出特定框架 (React 19) 的代码片段流。
- **基建中间件配置：**
    - **ES-Serverless：** 建立支持 Dense Vector 与 BM25 的混合索引模板。
    - **OSS：** 开启基础 Bucket 存储空间。
    - **Redis：** 部署实例并规划 Streams Topic 命名规范 (如 `stream:chat:{SessionID}`)，用于承载 Agent 执行时的多模态输出流。
    - **MySQL：** 初始化 `file_metadata` (资产表) 和 `user_todo` (待办事项表)。

> **🏆 Phase 1 交付标准 (Definition of Done):**
> 
> - ✅ **知识检索闭环：** 用户上传工作文档后，提问能精准召回片段，首字响应时间 (TTFT) 控制在 1.5 秒内。
> - ✅ **工具动态路由：** 当用户在一个会话中既问“公司报销标准是什么”（触发 `search_personal_kb`），又问“帮我查下今天北京天气”（触发 `search_web`）时，系统能准确识别意图并自动调用不同工具，最后合并给出回答。
> - ✅ **跨语言工具执行：** 用户输入“帮我把‘明天下午3点开架构评审会’加入待办”，Python Agent 能成功调用 Java 接口，并在前端立即渲染出一条可操作的 Todo 卡片。
> - ✅ **UI 动态生成 (Artifacts)：** 用户输入“给我写一个番茄钟计时器”，前端能无缝拦截流式代码，并在沙盒中成功渲染出可以直接点击交互的番茄钟应用。