{
  "info": {
    "_postman_id": "course-lesson-api-collection",
    "name": "Course Lesson API",
    "description": "课程产品详情接口 - 包含学生端和管理后台所有接口",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "token",
      "value": "",
      "type": "string"
    },
    {
      "key": "user_id",
      "value": "1",
      "type": "string"
    },
    {
      "key": "admin_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "admin_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "1",
      "type": "string"
    },
    {
      "key": "courseId",
      "value": "1",
      "type": "string"
    },
    {
      "key": "chapterId",
      "value": "1",
      "type": "string"
    },
    {
      "key": "lessonId",
      "value": "1",
      "type": "string"
    },
    {
      "key": "assignmentId",
      "value": "1",
      "type": "string"
    },
    {
      "key": "productId",
      "value": "1",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Auth - 认证相关",
      "item": [
        {
          "name": "用户登录",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"account\": \"{{username}}\",\n  \"password\": \"{{password}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/user/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "user", "login"]
            },
            "description": "用户登录接口，获取 Bearer Token"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Save admin_token from login response",
                  "if (pm.response.code === 200 && pm.request.url.path.join(',').includes('login')) {",
                  "    const jsonData = pm.response.json();",
                  "    console.log(jsonData)",
                  "    if (jsonData.data.token && jsonData.data.userId) {",
                  "        const userId = jsonData.data.userId;",
                  "        const roleLevel = jsonData.data.roleLevel;",
                  "        if (roleLevel > 5) {",
                  "            pm.collectionVariables.set('admin_token', jsonData.data.token);",
                  "            pm.collectionVariables.set('admin_id', userId.toString());",
                  "            console.log('Admin token saved: ' + jsonData.data.token);",
                  "        }",
                  "        pm.collectionVariables.set('user_token', jsonData.data.token);",
                  "        pm.collectionVariables.set('user_id', userId.toString());",
                  "        console.log('User token saved: ' + jsonData.data.token);",
                  "    }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "用户注册",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"testuser\",\n  \"password\": \"Test@123456\",\n  \"phone\": \"13800138000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/user/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "user", "register"]
            }
          }
        }
      ]
    },
    {
      "name": "Student - 学生端接口",
      "item": [
        {
          "name": "P0 - 激活课程",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"COURSE2024\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/student/courses/{{courseId}}/activate",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "student", "courses", "{{courseId}}", "activate"]
            },
            "description": "使用激活码激活/兑换课程"
          }
        },
        {
          "name": "P0 - 获取课程详情及大纲",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/student/courses/{{courseId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "student", "courses", "{{courseId}}"]
            },
            "description": "获取课程基本信息和章节课时大纲目录"
          }
        },
        {
          "name": "P0 - 获取课时详细内容",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/student/lessons/{{lessonId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "student", "lessons", "{{lessonId}}"]
            },
            "description": "获取课时详细内容，包含防盗链的临时 URL 和安全配置"
          }
        },
        {
          "name": "P0 - 上报学习进度",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"IN_PROGRESS\",\n  \"progressPayload\": {\n    \"currentTime\": 120,\n    \"duration\": 600\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/student/lessons/{{lessonId}}/progress",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "student", "lessons", "{{lessonId}}", "progress"]
            },
            "description": "上报学习进度，如视频播放时间、交互课进度等"
          }
        },
        {
          "name": "P0 - 提交作业",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"submissionPayload\": {\n    \"text_answer\": \"我的架构思路是...\",\n    \"file_urls\": [\"https://example.com/file.pdf\"]\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/student/assignments/{{lessonId}}/submit",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "student", "assignments", "{{lessonId}}", "submit"]
            },
            "description": "提交作业，支持文本答案和文件链接"
          }
        },
        {
          "name": "P1 - 我的课程列表",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/student/my-courses?current=1&pageSize=20",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "student", "my-courses"],
              "query": [
                {
                  "key": "current",
                  "value": "1"
                },
                {
                  "key": "pageSize",
                  "value": "20"
                }
              ]
            },
            "description": "获取用户已激活的课程列表和整体进度"
          }
        },
        {
          "name": "P1 - 查询作业状态",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/student/assignments/{{lessonId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "student", "assignments", "{{lessonId}}"]
            },
            "description": "查询某次作业的当前状态、得分及老师评语"
          }
        }
      ]
    },
    {
      "name": "Admin - 管理后台接口",
      "item": [
        {
          "name": "P0 - 创建/更新课程",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": null,\n  \"title\": \"Java 架构师课程\",\n  \"description\": \"从入门到精通的 Java 架构师课程\",\n  \"status\": \"PUBLISHED\",\n  \"productId\": {{productId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/courses",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "courses"]
            },
            "description": "创建或更新课程基础元数据，支持指定关联的产品ID"
          }
        },
        {
          "name": "P0 - 创建/更新章节",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": null,\n  \"courseId\": {{courseId}},\n  \"title\": \"第一章：Java 基础\",\n  \"sortOrder\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/chapters",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "chapters"]
            },
            "description": "管理课程的大纲结构"
          }
        },
        {
          "name": "P0 - 创建/更新课时",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": null,\n  \"chapterId\": {{chapterId}},\n  \"title\": \"第一节：Hello World\",\n  \"itemType\": \"VIDEO\",\n  \"isRequired\": true,\n  \"sortOrder\": 1,\n  \"contentPayload\": {\n    \"fileId\": \"your-file-uuid-here\",\n    \"duration\": 600\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/lessons",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "lessons"]
            },
            "description": "创建或更新课时内容，支持 VIDEO, DOCUMENT, PODCAST, ASSIGNMENT, INTERACTIVE 类型。contentPayload 中的 fileId 需要先通过文件上传接口上传后获取"
          }
        },
        {
          "name": "P0 - 作业列表",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"current\": 1,\n  \"pageSize\": 20,\n  \"courseId\": {{courseId}},\n  \"lessonId\": null,\n  \"status\": \"SUBMITTED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/assignments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "assignments"]
            },
            "description": "分页获取待批改或所有状态的作业列表"
          }
        },
        {
          "name": "P0 - 批改作业",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"score\": 90,\n  \"feedback\": \"完成得很好，继续保持!\",\n  \"rejected\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/assignments/{{assignmentId}}/grade",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "assignments", "{{assignmentId}}", "grade"]
            },
            "description": "批改作业，设置分数和评语"
          }
        },
        {
          "name": "P1 - 获取上传凭证",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/upload/presigned-url?objectName=courses/video1.mp4&contentType=video/mp4",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "upload", "presigned-url"],
              "query": [
                {
                  "key": "objectName",
                  "value": "courses/video1.mp4"
                },
                {
                  "key": "contentType",
                  "value": "video/mp4"
                }
              ]
            },
            "description": "获取上传文件的临时凭证，用于直传 OSS"
          }
        },
        {
          "name": "P1 - 查看用户课程",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/users/{{userId}}/courses",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "users", "{{userId}}", "courses"]
            },
            "description": "查看某位学生拥有的课程及详细进度"
          }
        },
        {
          "name": "P1 - 干预用户课程权限",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"accessStatus\": \"SUSPENDED\",\n  \"validUntil\": null\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/users/{{userId}}/courses/{{courseId}}/access",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "users", "{{userId}}", "courses", "{{courseId}}", "access"]
            },
            "description": "人工干预学生的课程权限，如封禁或延长有效期"
          }
        }
      ]
    },
    {
      "name": "Admin - 产品管理接口",
      "item": [
        {
          "name": "创建/更新产品",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": null,\n  \"name\": \"Java 架构师套餐\",\n  \"description\": \"包含完整课程和作业的套餐\",\n  \"baseCredits\": 100,\n  \"status\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/product/save",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "product", "save"]
            },
            "description": "创建或更新产品信息"
          }
        },
        {
          "name": "根据产品ID查询关联课程",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/product/{{productId}}/courses",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "product", "{{productId}}", "courses"]
            },
            "description": "根据产品ID查询该产品关联的所有课程列表"
          }
        },
        {
          "name": "手动激活产品",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"targetUserId\": {{userId}},\n  \"productId\": {{productId}},\n  \"remark\": \"人工添加权限\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/product/activate",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "product", "activate"]
            },
            "description": "无需激活码，手动为用户激活产品"
          }
        },
        {
          "name": "创建/更新产品课程树",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": null,\n  \"productName\": \"Python进阶课程\",\n  \"productDescription\": \"深入学习Python\",\n  \"productBaseCredits\": 100,\n  \"productStatus\": 1,\n  \"course\": {\n    \"courseId\": null,\n    \"title\": \"Python编程基础\",\n    \"description\": \"从零开始学习Python\",\n    \"status\": \"DRAFT\",\n    \"chapters\": [\n      {\n        \"chapterId\": null,\n        \"title\": \"第一章：Python简介\",\n        \"sortOrder\": 0,\n        \"lessons\": [\n          {\n            \"lessonId\": null,\n            \"title\": \"1.1 Python是什么\",\n            \"sortOrder\": 0,\n            \"itemType\": \"VIDEO\",\n            \"isRequired\": true,\n            \"contentPayload\": \"{\\\"fileId\\\": \\\"uuid-123\\\", \\\"duration\\\": 3600}\"\n          },\n          {\n            \"lessonId\": null,\n            \"title\": \"1.2 安装Python\",\n            \"sortOrder\": 1\n          }\n        ]\n      },\n      {\n        \"chapterId\": null,\n        \"title\": \"第二章：基础语法\",\n        \"sortOrder\": 1,\n        \"lessons\": [\n          {\n            \"lessonId\": null,\n            \"title\": \"2.1 变量与数据类型\",\n            \"sortOrder\": 0\n          }\n        ]\n      }\n    ]\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/product/tree",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "product", "tree"]
            },
            "description": "创建或更新产品-课程-章节-课时的完整层级结构。传ID则更新，不传ID则创建。支持混合创建和更新操作。"
          }
        },
        {
          "name": "查询产品课程树（BASIC）",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": {{productId}},\n  \"courseId\": null,\n  \"treeLevel\": \"BASIC\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/product/courses/query",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "product", "courses", "query"]
            },
            "description": "查询产品下的所有课程树（基础信息）。treeLevel可选：TITLES_ONLY/BASIC/FULL，默认BASIC。"
          }
        },
        {
          "name": "查询产品课程树（TITLES_ONLY）",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": {{productId}},\n  \"courseId\": null,\n  \"treeLevel\": \"TITLES_ONLY\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/product/courses/query",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "product", "courses", "query"]
            },
            "description": "查询产品下的所有课程树（仅标题，不含详细内容）"
          }
        },
        {
          "name": "查询单课程完整树（FULL）",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": {{productId}},\n  \"courseId\": {{courseId}},\n  \"treeLevel\": \"FULL\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/admin/product/courses/query",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "admin", "product", "courses", "query"]
            },
            "description": "查询单个课程的完整树形结构（包含所有详细信息）。需要指定courseId和treeLevel=FULL。"
          }
        }
      ]
    }
  ]
}
